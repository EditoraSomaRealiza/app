<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carta de Deus</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background: #f0f0f0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .carta {
      background: linear-gradient(to bottom right, #fffef5, #fdfdfd);
      font-family: 'Great Vibes', cursive;
      font-size: 22px;
      line-height: 1.8;
      color: #2b2b2b;
      padding: 60px;
      max-width: 800px;
      margin: auto;
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0,0,0,0.12);
      border: 1px solid #e8e6e0;
      position: relative;
    }
    .carta::before {
      content: "";
      background-image: url('https://i.imgur.com/0dXocqV.png');
      background-size: contain;
      background-repeat: no-repeat;
      position: absolute;
      bottom: 30px;
      right: 30px;
      width: 120px;
      height: 120px;
      opacity: 0.1;
    }
    .carta strong {
      font-family: Arial, sans-serif;
      display: block;
      margin-bottom: 10px;
    }
    .botoes {
      text-align: center;
      margin-top: 20px;
    }
    .btn-acao {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      border: none;
    }
    @media print {
      .botoes {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="carta" class="carta"></div>

  <div class="botoes">
    <button class="btn-acao" onclick="window.print()">üñ®Ô∏è Imprimir</button>
    <button class="btn-acao" onclick="baixarImagem()">üì• Baixar como imagem</button>
    <button class="btn-acao" onclick="baixarPDF()">üìÑ Baixar como PDF</button>
  </div>

  <script>
    function obterMensagem(nome, pedido) {
      if (!pedido) return `<center>Meu filho amado ${nome},</center><br>Mesmo quando voc√™ n√£o sabe o que dizer, Eu te compreendo por completo. Conhe√ßo o teu cora√ß√£o, tuas batalhas silenciosas e os teus sonhos mais profundos. Voc√™ n√£o est√° sozinho. Estou contigo em todos os momentos ‚Äî quando sorri, quando chora, quando pensa que ningu√©m v√™. Eu vejo. Eu ou√ßo. Eu amo.`;

      pedido = pedido.toLowerCase();

      if (pedido.includes("sozinh") || pedido.includes("abandonado")) {
        return `Meu filho ${nome}, voc√™ nunca esteve s√≥. Mesmo quando tudo parece sil√™ncio, Eu permane√ßo ao teu lado, segurando tua m√£o. Meu amor te envolve at√© nos dias mais escuros.`;
      } else if (pedido.includes("medo") || pedido.includes("p√¢nico") || pedido.includes("ansioso")) {
        return `${nome}, n√£o temas. Eu sou teu ref√∫gio e fortaleza. Quando o medo tentar te parar, lembra que Eu estou contigo, como um escudo invis√≠vel te protegendo.`;
      } else if (pedido.includes("dire√ß√£o") || pedido.includes("decis√£o") || pedido.includes("escolha")) {
        return `${nome}, entrega teus caminhos a Mim, e Eu endireitarei tuas veredas. Mesmo sem ver o fim, confia no come√ßo que Eu preparei.`;
      } else if (pedido.includes("gratid√£o") || pedido.includes("obrigado") || pedido.includes("agradecido")) {
        return `Fico feliz por ver teu cora√ß√£o grato, ${nome}. Minhas b√™n√ß√£os n√£o param quando voc√™ agradece ‚Äî elas se multiplicam. Eu me alegro contigo.`;
      } else if (pedido.includes("dor") || pedido.includes("triste") || pedido.includes("sofrimento") || pedido.includes("choro")) {
        return `Meu querido ${nome}, Eu recolho cada l√°grima que cai dos teus olhos. Nada passa despercebido diante de Mim. Confia ‚Äî teu al√≠vio vir√°.`;
      } else if (pedido.includes("saudade") || pedido.includes("perda") || pedido.includes("aus√™ncia")) {
        return `${nome}, at√© na aus√™ncia Eu sou presen√ßa. Aqueles que voc√™ ama est√£o sob Meu cuidado. Um dia, toda saudade ser√° consolo eterno.`;
      } else if (pedido.includes("f√©") || pedido.includes("d√∫vida") || pedido.includes("des√¢nimo")) {
        return `Filho ${nome}, n√£o desanime. Mesmo uma f√© pequena move montanhas. Estou contigo mesmo quando tua for√ßa parece pouca.`;
      }

      return `Meu filho amado ${nome},\n\nMesmo quando voc√™ n√£o sabe o que dizer, Eu te compreendo por completo. Conhe√ßo o teu cora√ß√£o, tuas batalhas silenciosas e os teus sonhos mais profundos. Voc√™ n√£o est√° sozinho. Estou contigo em todos os momentos ‚Äî quando sorri, quando chora, quando pensa que ningu√©m v√™. Eu vejo. Eu ou√ßo. Eu amo.`;
    }

    function preencherCarta() {
      const params = new URLSearchParams(window.location.search);
      const nome = decodeURIComponent(params.get("nome") || "");
      const pedido = decodeURIComponent(params.get("pedido") || "");

      if (!nome) {
        document.getElementById("carta").innerHTML = "<p>Nome n√£o informado.</p>";
        return;
      }

      const data = new Date();
      const hoje = data.toLocaleDateString("pt-BR");
      const hora = data.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });
      const mensagem = obterMensagem(nome, pedido);

      document.getElementById("carta").innerHTML = `
        <center><strong>Cidade Celestial, ${hoje} ‚Äì ${hora}</strong></center><br>
        ${mensagem.replace(/\n/g, '<br><br>')}<br>
        Com amor eterno,<br>
        <strong>Teu Pai Celestial</strong>
      `;
    }

    function baixarImagem() {
      html2canvas(document.getElementById("carta")).then(function(canvas) {
        const link = document.createElement("a");
        link.download = "carta_de_deus.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    function baixarPDF() {
      const { jsPDF } = window.jspdf;
      html2canvas(document.getElementById("carta")).then(function(canvas) {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF();
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save("carta_de_deus.pdf");
      });
    }

    preencherCarta();
  </script>
</body>
</html>
